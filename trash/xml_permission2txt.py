import os
import matplotlib.pyplot as plt

path =r'E:\KU-Android\train\KU-Android-pre-train\split_folder\train/'
type = os.listdir(path)

dict = {}

error_list = list()
#
f = open(r'E:\KU-Android\train\KU-Android-pre-train\txt\data.csv','w', newline='')
#
for type_num in range(len(type)):
    folder_path = path + type[type_num]
    folder_list = os.listdir(folder_path)


    error_num = 0
    for folder_num in range(len(folder_list)):
    #for folder_num in range(10):
        try:
            file_name = os.path.join(folder_path, folder_list[folder_num], 'AndroidManifest.xml')
            print(file_name)
            print(folder_num)

            file = open(file_name, 'r', encoding='utf_16_le')

            permision_list = list()
            line = file.readlines()

            txt = ''
            for i in range(len(line)):
                txt += line[i]

            #txt = txt.split('.permission.')
            txt = txt.split('android.')
            permission = list()
            for i in range(2,len(txt)):
                permission.append(txt[i].split('\x00')[0])



            print(permission)
            """
            if not os.path.isdir(os.path.join(r'E:\KU-Android\train\KU-Android-pre-train\txt', type[type_num])):
                os.makedirs(os.path.join(r'E:\KU-Android\train\KU-Android-pre-train\txt', type[type_num]))

            f = open(os.path.join(r'E:\KU-Android\train\KU-Android-pre-train\txt', type[type_num] ,str(folder_num))+ ".txt", 'w')

            for line_len in range(len(permission)):
                f.writelines(permission[line_len])
                f.write("\n")
            f.close
            """
            row = ""
            for p_i in range(len(permission)):
                row += permission[p_i] + " "

            import csv

            csv_writer = csv.writer(f)
            csv_writer.writerow([type[type_num], row])
        except:
            error_list.append(os.path.join(r'E:\KU-Android\train\KU-Android-pre-train\txt', type[type_num] ,str(folder_list[folder_num])))
            error_num += 1

print(error_list)
import shutil

for i in range(len(error_list)):
    name = error_list[i].split('\\')
    print(name)
    #shutil.move(error_list[i], os.path.join(r'E:\KU-Android\train\KU-Android-pre-train\split_folder\train\error', name[-1]))