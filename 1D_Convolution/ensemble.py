import os

#
Train_path = r'C:\Users\User\Desktop\보안-\text-classification-tutorial-master\android_parsing\total_data.csv'

x_train = list()
y_train = list()

import csv
f = open(Train_path, 'r')
csvReader = csv.reader(f)

for row in csvReader:
    x_train.append(row[1])
    y_train.append(row[0])
f.close()

for i in range(len(y_train)):#문자열은 test를 못하니까, normal 이면 0으로, malware면 1로
    if y_train[i] == 'normal':
        y_train[i] = 0
    elif y_train[i] == 'malware':
        y_train[i] = 1

from sklearn.model_selection import train_test_split
x_train, x_test, y_train, y_test = train_test_split(x_train, y_train, test_size=0.15, random_state=0) #(15% 테스트로)
#"""extracting Test Permission Data

f = open(r'C:\Users\User\Documents\GitHub\malware_detector\1D_Permission\1d_permission.txt', 'r')
f1 = open(r'C:\Users\User\Documents\GitHub\malware_detector\1D_Permission\\permission.txt', 'r')

convolution = f.readlines()
permission = f1.readlines()

_1dconv = list()
for i in range(len(convolution)):
    _1dconv.append(float(convolution[i]))

per = list()
for i in range(len(permission)):
    per.append(float(permission[i]))

print(_1dconv)
print(per)


threshold = 1
#x = 1
max = 0
max_x = 0
for t in range(100):
    x = 1
    threshold = threshold - 0.01
    for i in range(200):
        sum_y = list()
        count = 0
        for j in range(len(_1dconv)):
            sum = ((_1dconv[j] * x) + (1-(per[j] * (1-x))))/2
            if sum < threshold:   #benign
                sum_y.append(0)
            else:          #malware
                sum_y.append(1)
        for j in range(len(_1dconv)):
            if(y_test[j] == sum_y[j]):
                count+=1
        if count > max:
            max = count
            max_x = x
        print(count)
        x = x - 0.01
            #print(count)
print(max)
print(max_x)